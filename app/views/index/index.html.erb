<%= render :partial => 'shared/main_content' %>

<table class="table">
  <thead>
    <tr>
      <th>Company Name</th>
      <th>First Name</th>
      <th>Last Name</th>
      <th>E-mail</th>
      <th colspan="2"></th>
    </th>
  </thead>
  <tbody>
    <% @clients.each do |i| %>
      <tr>
        <td><%= i['client_name'] %></td>
        <td><%= i['first_name'] %></td>
        <td><%= i['last_name'] %></td>
        <td><%= i['email'] %></td>
        <td>
          <%= link_to 'Edit', edit_client_path(i['id']), :class => "btn btn-link" %>
          <%= button_tag 'Projects', :class => "btn btn-primary btn-xs" %>
          <%= button_tag 'Invoices', :class => "btn btn-success btn-xs", 
            "data-toggle" => "invoices-modal", "data-target" => "clientInvoices",
            "data-id" => i['id'], 
            "onClick" => "$('#clientInvoices .modal-body #client_id').val('#{i['id']}'); getInvoices(); $('#clientInvoices').modal()"
          %>
          <%= button_tag 'Delete', :class => "btn btn-danger btn-xs", 
            "data-toggle" => "modal", "data-target" => "confirmDelete", 
            "data-id" => i['id'],
            "onClick" => "$('.modal-body #customer_key').val( '#{i['customer_key']}' ); $('.modal-body #clientId').val( #{i['id']} ); $('#confirmDelete').modal()" 
          %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

<%= render :partial => 'shared/list_invoices' %>

<%= render :partial => 'shared/delete_client' %>

<script type="text/javascript">
  $('#del-confirmation').bind('blur keyup', function(){
    if ($('#del-confirmation').val().match(/delete/i) != null){
      $('#delete').show()
    }else{
      $('#delete').hide()
    }
  })

  function getInvoices(){
    var clientId     = $('#client_id').val();
    $.ajax({
      url: '/c/'+clientId,
      type: 'GET',
      data: { },
      success: function(result){}
    });
  }

  function deleteClient(){
    var clientId     = $('#clientId').val();
    var customer_key = $('#customer_key').val();
    $.ajax({
      url: '/client/'+clientId,
      type: 'DELETE',
      data: { customer_key: customer_key },
      success: function(result) {
        window.location.reload();
      }
    });
  }
</script>