<%= render :partial => 'shared/main_content' %>

<table class="table">
  <thead>
    <tr>
      <th>Company Name</th>
      <th>First Name</th>
      <th>Last Name</th>
      <th>E-mail</th>
      <th colspan="2"></th>
    </th>
  </thead>
  <tbody>
    <% @clients.each do |i| %>
      <tr>
        <td><%= i['client_name'] %></td>
        <td><%= i['first_name'] %></td>
        <td><%= i['last_name'] %></td>
        <td><%= i['email'] %></td>
        <td>
          <%= link_to 'Edit', edit_client_path(i['id']), :class => "btn btn-link" %>
          <%= button_tag 'Projects', :class => "btn btn-primary btn-xs" %>
          <%= button_tag 'Invoices', :class => "btn btn-success btn-xs" %>
          <%= button_tag 'Delete', :class => "btn btn-danger btn-xs", 
            "data-toggle" => "modal", "data-target" => "confirmDelete", 
            "data-id" => i['id'],
            "onClick" => "$('.modal-body #customer_key').val( '#{i['customer_key']}' ); $('.modal-body #clientId').val( #{i['id']} ); $('#confirmDelete').modal()" %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

<!-- Modal -->
<div class="modal fade" id="confirmDelete" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog" style="margin-top:15%;width:400px;">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="myModalLabel">Are you sure you want to delete?</h4>
      </div>
      <div class="modal-body">
        <form role="form">
          <input type="hidden" id="clientId"/>
          <input type="hidden" id="customer_key"/>
          <input type="text" class="form-control" style="width:250px;" id="del-confirmation">
          <span class="help-block">Please type delete.</span>
        </form>
      </div>
      <div class="modal-footer" id="delete">
        <%= button_tag 'Delete', :class => "btn btn-danger", :onClick => "deleteClient(); return false;" %>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<script type="text/javascript">
  $('#del-confirmation').bind('blur keyup', function(){
    if ($('#del-confirmation').val().match(/delete/i) != null){
      $('#delete').show()
    }else{
      $('#delete').hide()
    }
  })

  function deleteClient(){
    var clientId     = $('#clientId').val();
    var customer_key = $('#customer_key').val();
    $.ajax({
      url: '/client/'+clientId,
      type: 'DELETE',
      data: { customer_key: customer_key },
      success: function(result) {
        window.location.reload();
      }
    });
  }
</script>